if [[ -e /usr/bin/java ]]; then
	f=$(readlink -f /usr/bin/java)
	export JAVA_HOME=$(readlink -f "${f%/*}/../../lib")
fi

if command -v gnome-disk-image-mounter >/dev/null 2>&1; then
	mount-iso-readonly() {
		re="\.iso$"
		if [[ -z "$1" || ! "$1" =~ $re ]]; then
			cat <<EOT
mount-iso-readonly: mount an ISO image for reading
Usage: mount-iso-readonly <iso_file>
EOT
			return
		fi
		gnome-disk-image-mounter "$1" || exit $?
		mount_path=$(mount | grep "$1" | awk '{print $3}')
		cd "$mount_path" || return 1
	}

	mount-iso-writable() {
		re="\.iso$"
		if [[ -z "$1" || ! "$1" =~ $re ]]; then
			cat <<EOT
mount-iso-writable: mount an ISO image for writing
Usage: mount-iso-writable <iso_file>
EOT
			return
		fi
		gnome-disk-image-mounter --writable "$1" || exit $?
		mount_path=$(mount | grep "$1" | awk '{print $3}')
		cd "$mount_path" || return 1
	}
fi

if [[ "$ROPERDOT_DESKTOP_ENV" = windows ]]; then
	win-env() {
		if [[ "$1" == "--help" || "$1" == "-h" || "$1" == "-?" ]]; then
			cat <<EOT
win-env: get the value of a Windows env var
Usage: win-env [var-name]

If win_env is called with no arguments, it will show all of the environment
variables defined for Windows.
EOT
			return
		fi
		if [[ "$#" -eq 0 ]]; then
			cmd.exe /c set 2>/dev/null
		else
			cmd.exe /c echo %$1% 2>/dev/null | tr -d '\r'
		fi
	}

	win-env-linux-path() {
		if [[ $# -eq 0 || "$1" == "--help" || "$1" == "-h" || "$1" == "-?" ]]; then
			cat <<EOT
win-env-linux-path: get the value of a Windows env var and convert to a WSL path
Usage: win-env-linux-path <var-name>

The value of the Windows environment variable named var-name will be echoed
after being converted to a WSL path using wslpath.
EOT
			return
		fi
		local winpath="$(cd /mnt/c && cmd.exe /c echo %$1% 2>/dev/null | tr -d '\r')"
		echo $(wslpath "$winpath")
	}

	def-win-env-linux-path() {
		if [[ $# -eq 0 || "$1" == "--help" || "$1" == "-h" || "$1" == "-?" ]]; then
			cat <<EOT
def-win-env-linux-path: define an env var from a Windows env var and convert to a WSL path
Usage: def-win-env-linux-path <var-name> [var-name-to-set]

The value of the Windows environment variable named var-name will be exported
to an environment variable with the same name after being converted to a WSL
path using wslpath. If var-name-to-set is passed, that variable will be
exported instead of using the same name as var-name.
EOT
			return
		fi
		local winpath="$(cd /mnt/c && cmd.exe /c echo %$1% 2>/dev/null | tr -d '\r')"
		export "${2:-$1}=$(wslpath "$winpath")"
	}

	export rd_program_files="$(win-env-linux-path PROGRAMFILES)"
	export rd_program_files_x86="$(win-env-linux-path "PROGRAMFILES(X86)")"

	alias afk="Rundll32.exe user32.dll,LockWorkStation"
fi