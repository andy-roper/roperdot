#
# Description: Install script for P4Merge
#
# Author: Andy Roper <andyroper42@gmail.com>
# URL: https://github.com/andy-roper/roperdot
#

# Last updated for current version for Linux on 15 Aug 2025
# https://www.perforce.com/downloads/visual-merge-tool

if [[ "$ROPERDOT_OS_FAMILY" = debian && "$ROPERDOT_DESKTOP_ENV" = gnome ]]; then
	cd "$(mktemp -d)" || return 1
	get-web-file https://cdist2.perforce.com/perforce/r25.2/bin.linux26x86_64/p4v.tgz
	sudo tar xfz p4v.tgz -C /opt/
	rm p4v.tgz
	app_path=$(find /opt -maxdepth 1 -name "p4v*")
	ln -s ${app_path}/bin/p4merge "${ROPERDOT_DIR}/extra-bin/p4merge"
	[[ -d "$HOME/.local/share/icons" ]] || mkdir -p "$HOME/.local/share/icons"
	cp ${app_path}/lib/P4VResources/icons/p4merge.svg "$HOME/.local/share/icons"
	[[ -d "$HOME/.local/share/applications" ]] || mkdir -p "$HOME/.local/share/applications"
	cat << EOT > "$HOME/.local/share/applications/p4merge.desktop"
[Desktop Entry]
Encoding=UTF-8
Version=2025.2
Name=P4Merge
Type=Application
Exec=${app_path}/bin/p4merge
Icon=p4merge.svg
Terminal=false
Categories=Development;Programming
EOT
fi